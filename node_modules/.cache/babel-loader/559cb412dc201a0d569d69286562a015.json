{"ast":null,"code":"import _objectSpread from\"C:/Users/Admin/Desktop/\\u0412\\u044F\\u0447\\u0435\\u0441\\u043B\\u0430\\u0432/Projects/1479361-what-to-watch-9/project/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/Admin/Desktop/\\u0412\\u044F\\u0447\\u0435\\u0441\\u043B\\u0430\\u0432/Projects/1479361-what-to-watch-9/project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _toConsumableArray from\"C:/Users/Admin/Desktop/\\u0412\\u044F\\u0447\\u0435\\u0441\\u043B\\u0430\\u0432/Projects/1479361-what-to-watch-9/project/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import{useState}from'react';import{useAppDispatch,useAppSelector}from'../../hooks';import{store}from'../../store';import{addCommentsAction,fetchCommentsAction}from'../../store/api-action';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var COUNT_STARS=10;var MIN_COMMENT_LENGTH=50;var MAX_COMMENT_LENGTH=400;var stars=_toConsumableArray(Array(COUNT_STARS).keys());var disabledPostButton=function disabledPostButton(postFormValues){if(postFormValues.comment.length>MIN_COMMENT_LENGTH&&postFormValues.comment.length<MAX_COMMENT_LENGTH){return false;}return true;};function CommentSubmissionForm(props){var dispatch=useAppDispatch();var loadingComment=useAppSelector(function(state){return state.loadingComment;});var _useState=useState({comment:'',rating:-1}),_useState2=_slicedToArray(_useState,2),postFormValues=_useState2[0],setPostFormValues=_useState2[1];var onStarChange=function onStarChange(event){if(event.target){setPostFormValues(_objectSpread(_objectSpread({},postFormValues),{},{rating:Number(event.currentTarget.value)}));}};var onStarClick=function onStarClick(event){if(event.target&&event.currentTarget.checked){setPostFormValues(_objectSpread(_objectSpread({},postFormValues),{},{rating:Number(event.currentTarget.value)}));}};var rating=postFormValues.rating;var fieldChangeHandler=function fieldChangeHandler(evt){evt.preventDefault();var dataCommentFilm={id:props.id,dataComment:{comment:postFormValues.comment,rating:postFormValues.rating}};dispatch(addCommentsAction(dataCommentFilm));store.dispatch(fetchCommentsAction(props.id));};return/*#__PURE__*/_jsx(\"div\",{className:\"add-review\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:fieldChangeHandler,action:\"\",className:\"add-review__form\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"rating\",children:/*#__PURE__*/_jsx(\"div\",{className:\"rating__stars\",children:stars.map(function(it){return/*#__PURE__*/_jsxs(\"div\",{onClick:function onClick(){return setPostFormValues({rating:it+1,comment:postFormValues.comment});},children:[/*#__PURE__*/_jsx(\"input\",{className:\"rating__input\",id:\"star-\".concat(it),type:\"radio\",name:\"reting-\".concat(it),value:it,checked:it<rating,onChange:onStarChange,onClick:onStarClick}),/*#__PURE__*/_jsxs(\"label\",{className:\"rating__label\",htmlFor:\"star-\".concat(it),children:[\"Rating \",it+1]})]},it);}).reverse()})}),/*#__PURE__*/_jsxs(\"div\",{className:\"add-review__text\",children:[/*#__PURE__*/_jsx(\"textarea\",{onChange:function onChange(evt){return setPostFormValues({comment:evt.target.value,rating:postFormValues.rating});},className:\"add-review__textarea\",name:\"review-text\",id:\"review-text\",placeholder:\"Review text\",minLength:50,maxLength:400}),/*#__PURE__*/_jsx(\"div\",{className:\"add-review__submit\",children:/*#__PURE__*/_jsx(\"button\",{disabled:disabledPostButton(postFormValues)||loadingComment,className:\"add-review__btn\",type:\"submit\",children:\"Post\"})})]})]})});}export default CommentSubmissionForm;","map":{"version":3,"sources":["C:/Users/Admin/Desktop/Вячеслав/Projects/1479361-what-to-watch-9/project/src/components/comment-submission-form/comment-submission-form.tsx"],"names":["useState","useAppDispatch","useAppSelector","store","addCommentsAction","fetchCommentsAction","COUNT_STARS","MIN_COMMENT_LENGTH","MAX_COMMENT_LENGTH","stars","Array","keys","disabledPostButton","postFormValues","comment","length","CommentSubmissionForm","props","dispatch","loadingComment","state","rating","setPostFormValues","onStarChange","event","target","Number","currentTarget","value","onStarClick","checked","fieldChangeHandler","evt","preventDefault","dataCommentFilm","id","dataComment","map","it","reverse"],"mappings":"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","sourcesContent":["import { MouseEvent, ChangeEvent, FormEvent, useState } from 'react';\nimport { useAppDispatch, useAppSelector } from '../../hooks';\nimport { store } from '../../store';\nimport { addCommentsAction, fetchCommentsAction } from '../../store/api-action';\nimport { Film } from '../../types';\n\nconst COUNT_STARS = 10;\nconst MIN_COMMENT_LENGTH = 50;\nconst MAX_COMMENT_LENGTH = 400;\n\nconst stars = [...Array(COUNT_STARS).keys()];\ninterface PostFormValues {\n  comment: string;\n  rating: number;\n}\n\n\nconst disabledPostButton = (postFormValues: PostFormValues): boolean => {\n  if(postFormValues.comment.length > MIN_COMMENT_LENGTH\n    && postFormValues.comment.length < MAX_COMMENT_LENGTH\n  ){\n    return false;\n  }\n  return true;\n};\n\nfunction CommentSubmissionForm(props: Film) {\n  const dispatch = useAppDispatch();\n  const loadingComment = useAppSelector((state) => state.loadingComment);\n\n  const [postFormValues, setPostFormValues] = useState<PostFormValues>({\n    comment: '',\n    rating: -1,\n  });\n\n  const onStarChange = (event: ChangeEvent<HTMLInputElement>) => {\n    if (event.target) {\n      setPostFormValues({ ...postFormValues, rating: Number(event.currentTarget.value) });\n    }\n  };\n\n  const onStarClick = (event: MouseEvent<HTMLInputElement>) => {\n    if (event.target && event.currentTarget.checked) {\n      setPostFormValues({ ...postFormValues, rating: Number(event.currentTarget.value) });\n    }\n  };\n\n  const { rating } = postFormValues;\n\n  const fieldChangeHandler = (evt: FormEvent<HTMLFormElement> ) => {\n    evt.preventDefault();\n\n    const dataCommentFilm = {\n      id: props.id,\n      dataComment: {\n        comment: postFormValues.comment,\n        rating: postFormValues.rating,\n      },\n    };\n\n\n    dispatch(addCommentsAction(dataCommentFilm));\n    store.dispatch(fetchCommentsAction(props.id));\n  };\n\n  return (\n    <div  className=\"add-review\">\n      <form onSubmit={ fieldChangeHandler} action=\"\" className=\"add-review__form\">\n        <div className=\"rating\">\n          <div className=\"rating__stars\">\n            {stars.map((it)=> (\n              <div key={it} onClick={() => setPostFormValues({rating: it + 1 , comment: postFormValues.comment})}>\n                <input\n                  className=\"rating__input\" id={`star-${it}`}\n                  type=\"radio\" name={`reting-${it}`}\n                  value={it}\n                  checked={it < rating}\n                  onChange={onStarChange}\n                  onClick={onStarClick}\n                />\n                <label className=\"rating__label\" htmlFor={`star-${it}`}>Rating {it + 1}</label>\n              </div>)).reverse()}\n          </div>\n        </div>\n\n        <div className=\"add-review__text\" >\n          <textarea\n            onChange={(evt) => setPostFormValues({comment: evt.target.value, rating: postFormValues.rating})}\n            className=\"add-review__textarea\"\n            name=\"review-text\" id=\"review-text\"\n            placeholder=\"Review text\"\n            minLength={50}\n            maxLength={400}\n          >\n          </textarea>\n          <div className=\"add-review__submit\">\n            <button disabled={\n              disabledPostButton(postFormValues) || loadingComment\n            }\n            className=\"add-review__btn\" type=\"submit\"\n            >Post\n            </button>\n          </div>\n\n        </div>\n      </form>\n    </div>\n  );\n}\n\nexport default CommentSubmissionForm;\n"]},"metadata":{},"sourceType":"module"}